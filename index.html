<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DUAL AGENT v2.0</title>
    <style>
        :root {
            --bg-color: #000000;
            --text-main: #ffffff;
            --highlight-a: #ff3333; /* A: ç´… */
            --highlight-b: #3388ff; /* B: è— */
            --common: #00ff41;      /* é€šç”¨ç¶  */
            --danger: #ff0000;      /* çˆ†ç‚¸ç´… */
            --btn-text: #000000;    /* æŒ‰éˆ•æ–‡å­—é»‘ */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 0;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
        }

        .hidden { display: none !important; }

        /* --- 1. è§’è‰²é¸æ“‡ --- */
        #screen-select {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px;
        }
        .role-btn {
            width: 100%; max-width: 320px; padding: 30px; margin: 15px 0;
            font-size: 1.5rem; font-weight: bold; border-radius: 16px;
            border: 2px solid #555; background: #111; color: #fff; cursor: pointer;
            text-transform: uppercase; transition: transform 0.1s;
        }
        .role-btn:active { transform: scale(0.95); }
        .role-a { border-color: var(--highlight-a); color: var(--highlight-a); box-shadow: 0 0 15px rgba(255, 51, 51, 0.2); }
        .role-b { border-color: var(--highlight-b); color: var(--highlight-b); box-shadow: 0 0 15px rgba(51, 136, 255, 0.2); }

        /* --- 2. éŠæˆ²ä¸»ç•«é¢ --- */
        #screen-game {
            flex: 1; display: flex; flex-direction: column; align-items: center;
            padding: 20px; padding-bottom: 50px; overflow-y: auto;
        }

        .status-bar {
            width: 100%; max-width: 400px; display: flex; justify-content: space-between; 
            border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px;
            font-size: 1rem; color: #888; font-weight: bold;
        }

        /* ç›®æ¨™å€ (å«è‹±æ–‡) */
        .target-area { 
            text-align: center; margin-bottom: 20px; padding: 20px;
            background: rgba(255,255,255,0.08); border-radius: 16px; width: 100%; max-width: 400px;
            border: 1px solid #333;
        }
        .target-icon { font-size: 5rem; display: block; margin-bottom: 5px; animation: pulse 2s infinite; }
        .target-name { font-size: 1.8rem; color: #fff; font-weight: 900; letter-spacing: 2px; display: block; }
        .target-en { font-size: 1.2rem; color: var(--common); font-weight: bold; display: block; margin-top: 5px; letter-spacing: 1px; }
        
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }

        /* è¼¸å…¥å€ */
        .input-area { width: 100%; max-width: 400px; text-align: center; margin-bottom: 20px; }
        .game-input {
            background: #000; border: 3px solid #666; color: #fff;
            font-size: 2.5rem; padding: 10px; width: 100%; text-align: center;
            border-radius: 12px; outline: none; font-family: inherit; letter-spacing: 4px;
            text-transform: uppercase; margin-bottom: 15px;
        }
        
        /* ä¿®æ­£å¾Œçš„ UNLOCK æŒ‰éˆ• */
        .submit-btn {
            width: 100%; padding: 18px; font-size: 1.4rem;
            background: #e0e0e0; color: #000; /* é è¨­äº®è‰² */
            border: none; border-radius: 12px; font-weight: 900;
            box-shadow: 0 4px 15px rgba(255,255,255,0.1);
            transition: all 0.1s;
        }
        .submit-btn:active { transform: scale(0.98); }

        /* å‰©é¤˜æ¬¡æ•¸ */
        #lives-box { color: #888; font-size: 0.9rem; margin-bottom: 10px; }

        /* å¯†ç¢¼æœ¬æŒ‰éˆ•å€ */
        .codebook-btn-container { width: 100%; max-width: 400px; margin-top: auto; }
        .codebook-btn {
            width: 100%; padding: 20px;
            background: var(--common); color: #000;
            border: none; border-radius: 16px; font-size: 1.3rem; font-weight: 900;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }
        .codebook-btn:active { transform: scale(0.98); filter: brightness(0.9); }

        /* --- 3. è¦–çª— (Modal) --- */
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #111; z-index: 100; display: flex; flex-direction: column;
        }
        .modal-header {
            padding: 15px; background: #222; border-bottom: 2px solid #444; display: flex; justify-content: space-between; align-items: center;
        }
        .tabs { display: flex; width: 100%; background: #000; padding: 10px; gap: 10px; }
        .tab-btn {
            flex: 1; padding: 12px 0; background: #1a1a1a; color: #888; border: 2px solid #333; border-radius: 8px; font-weight: bold;
        }
        .tab-btn.active { background: #222; color: var(--common); border-color: var(--common); }
        
        #code-list {
            flex: 1; overflow-y: auto; padding: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; align-content: start; padding-bottom: 50px;
        }
        .code-item {
            background: #1a1a1a; padding: 10px; border-radius: 12px; border: 1px solid #333; display: flex; flex-direction: column; align-items: center; text-align: center;
        }
        .item-code { color: var(--common); font-size: 1.5rem; font-weight: 900; letter-spacing: 1px; margin: 5px 0; }
        .item-en { color: #fff; font-size: 0.8rem; font-weight: bold; }
        .item-cn { color: #888; font-size: 0.8rem; }

        /* --- 4. æˆåŠŸèˆ‡å¤±æ•—ç•«é¢ --- */
        #screen-success, #screen-fail {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 90; text-align: center; padding: 20px;
        }
        
        #screen-success { background: rgba(0, 30, 0, 0.98); }
        #screen-fail { background: rgba(30, 0, 0, 0.98); }

        .big-icon { font-size: 6rem; margin-bottom: 20px; display: block; }
        .title-msg { font-size: 2.5rem; font-weight: 900; margin: 0; letter-spacing: 2px; }
        .sub-msg { font-size: 1.2rem; margin-top: 10px; opacity: 0.8; color: #fff; }
        
        .action-btn {
            padding: 20px 40px; font-size: 1.5rem; border: none; border-radius: 50px; 
            margin-top: 40px; font-weight: bold; box-shadow: 0 0 30px rgba(255,255,255,0.2);
            cursor: pointer;
        }

    </style>
</head>
<body>

    <div id="screen-select">
        <div style="text-align:center; margin-bottom:40px; border:4px solid #fff; padding:15px;">
            <h1 style="margin:0; letter-spacing:4px; line-height:1;">DUAL<br>AGENT</h1>
        </div>
        
        <button class="role-btn role-a" onclick="initGame('A')">ğŸ”´ æˆ‘æ˜¯ç‰¹å‹™ A</button>
        <button class="role-btn role-b" onclick="initGame('B')">ğŸ”µ æˆ‘æ˜¯ç‰¹å‹™ B</button>
        
        <p style="color:#666; font-size:0.9rem; margin-top:40px;">è«‹é¸æ“‡ä¸åŒèº«åˆ†</p>
    </div>

    <div id="screen-game" class="hidden">
        <div class="status-bar">
            <span id="role-indicator">AGENT ?</span>
            <span id="level-indicator">LEVEL 1</span>
        </div>

        <div class="target-area">
            <div style="color: #888; font-size: 0.9rem; margin-bottom: 5px;">CURRENT TARGET (ç›®æ¨™)</div>
            <span id="target-icon" class="target-icon">â“</span>
            <span id="target-name" class="target-name">LOADING...</span>
            <span id="target-en" class="target-en">LOADING...</span>
        </div>

        <div class="input-area">
            <div id="lives-box">â¤ï¸â¤ï¸â¤ï¸</div>
            <input type="text" id="input-code" class="game-input" placeholder="CODE" maxlength="4" autocomplete="off">
            
            <button id="unlock-btn" class="submit-btn" onclick="checkCode()">è§£é– / UNLOCK</button>
        </div>

        <div class="codebook-btn-container">
            <button class="codebook-btn" onclick="openCodebook()">ğŸ“– å¯†ç¢¼æœ¬ (çµ¦éšŠå‹)</button>
        </div>
    </div>

    <div id="screen-success" class="hidden">
        <div class="big-icon">âœ…</div>
        <h2 class="title-msg" style="color:var(--common);">SUCCESS</h2>
        <p class="sub-msg">ä»£ç¢¼æ­£ç¢º / ACCESS GRANTED</p>
        <p id="success-counter" style="color:#fff; font-size:1rem; border:1px solid #fff; padding:5px 10px; border-radius:20px;">
            å·²å®Œæˆ 0 å€‹ä»»å‹™
        </p>
        <button class="action-btn" style="background:var(--common); color:#000;" onclick="nextLevel()">
            ä¸‹ä¸€é—œ â”
        </button>
    </div>

    <div id="screen-fail" class="hidden">
        <div class="big-icon">ğŸ’£ğŸ’¥</div>
        <h2 class="title-msg" style="color:var(--danger);">MISSION FAILED</h2>
        <p class="sub-msg">ä»»å‹™å¤±æ•— / SYSTEM DESTROYED</p>
        <button class="action-btn" style="background:var(--danger); color:#fff;" onclick="location.reload()">
            ç³»çµ±é‡å•Ÿ â†»
        </button>
    </div>

    <div id="modal-overlay" class="hidden">
        <div class="modal-header">
            <div class="modal-title" style="color:#fff;">æŸ¥è©¢éšŠå‹ä»£ç¢¼</div>
            <button style="background:none; border:none; color:#fff; font-size:2rem;" onclick="closeCodebook()">âœ•</button>
        </div>
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('fruits')" id="tab-fruits">æ°´æœ</button>
            <button class="tab-btn" onclick="switchTab('animals')" id="tab-animals">å‹•ç‰©</button>
            <button class="tab-btn" onclick="switchTab('plants')" id="tab-plants">æ¤ç‰©</button>
        </div>
        <div id="code-list"></div>
    </div>

    <script>
        // --- è³‡æ–™åº« (å«è‹±æ–‡) ---
        const database = {
            A: {
                fruits: [
                    {n:'é¦™è•‰', en:'BANANA', i:'ğŸŒ', c:'A3X9'}, {n:'è˜‹æœ', en:'APPLE', i:'ğŸ', c:'P8K2'}, 
                    {n:'è‘¡è„', en:'GRAPE', i:'ğŸ‡', c:'L5Z1'}, {n:'è¥¿ç“œ', en:'WATERMELON', i:'ğŸ‰', c:'W4N7'}, 
                    {n:'è‰è“', en:'STRAWBERRY', i:'ğŸ“', c:'S9R3'}, {n:'é³³æ¢¨', en:'PINEAPPLE', i:'ğŸ', c:'B2M6'},
                    {n:'æ©˜å­', en:'TANGERINE', i:'ğŸŠ', c:'O7T4'}, {n:'æª¸æª¬', en:'LEMON', i:'ğŸ‹', c:'Y1H5'}, 
                    {n:'æ¡ƒå­', en:'PEACH', i:'ğŸ‘', c:'J6Q8'}, {n:'æ«»æ¡ƒ', en:'CHERRY', i:'ğŸ’', c:'C3V9'}, 
                    {n:'æ¢¨å­', en:'PEAR', i:'ğŸ', c:'D5F2'}, {n:'å¥‡ç•°æœ', en:'KIWI', i:'ğŸ¥', c:'G8E4'}
                ],
                animals: [
                    {n:'ç…å­', en:'LION', i:'ğŸ¦', c:'H4U9'}, {n:'è€è™', en:'TIGER', i:'ğŸ¯', c:'T7I2'}, 
                    {n:'ç†Š', en:'BEAR', i:'ğŸ»', c:'B5O1'}, {n:'ç‹¼', en:'WOLF', i:'ğŸº', c:'W8Y6'}, 
                    {n:'ç‹ç‹¸', en:'FOX', i:'ğŸ¦Š', c:'F3L7'}, {n:'ç†Šè²“', en:'PANDA', i:'ğŸ¼', c:'P9A4'},
                    {n:'ç„¡å°¾ç†Š', en:'KOALA', i:'ğŸ¨', c:'K2J8'}, {n:'å…”å­', en:'RABBIT', i:'ğŸ°', c:'R6M3'}, 
                    {n:'è€é¼ ', en:'MOUSE', i:'ğŸ­', c:'M1N5'}, {n:'è²“å’ª', en:'CAT', i:'ğŸ±', c:'C7X2'}, 
                    {n:'ç‹—ç‹—', en:'DOG', i:'ğŸ¶', c:'D4Q9'}, {n:'çŒ´å­', en:'MONKEY', i:'ğŸµ', c:'S2Z6'}
                ],
                plants: [
                    {n:'ä»™äººæŒ', en:'CACTUS', i:'ğŸŒµ', c:'C8K3'}, {n:'æ¾æ¨¹', en:'PINE TREE', i:'ğŸŒ²', c:'T5R9'}, 
                    {n:'å‘æ—¥è‘µ', en:'SUNFLOWER', i:'ğŸŒ»', c:'S2L6'}, {n:'ç«ç‘°', en:'ROSE', i:'ğŸŒ¹', c:'R7V4'}, 
                    {n:'é¬±é‡‘é¦™', en:'TULIP', i:'ğŸŒ·', c:'U1H8'}, {n:'æ¥“è‘‰', en:'MAPLE', i:'ğŸ', c:'M9P2'},
                    {n:'è˜‘è‡', en:'MUSHROOM', i:'ğŸ„', c:'F4X7'}, {n:'ç«¹å­', en:'BAMBOO', i:'ğŸ‹', c:'B6O3'}, 
                    {n:'æ¤°å­æ¨¹', en:'PALM TREE', i:'ğŸŒ´', c:'P3Y5'}, {n:'å¹¸é‹è‰', en:'CLOVER', i:'ğŸ€', c:'L8N1'}, 
                    {n:'ç¨»ç©—', en:'RICE', i:'ğŸŒ¾', c:'G5J2'}, {n:'èŠ™è“‰', en:'HIBISCUS', i:'ğŸŒº', c:'H9Q4'}
                ]
            },
            B: {
                fruits: [
                    {n:'é¦™è•‰', en:'BANANA', i:'ğŸŒ', c:'K9R2'}, {n:'è˜‹æœ', en:'APPLE', i:'ğŸ', c:'Z4M7'}, 
                    {n:'è‘¡è„', en:'GRAPE', i:'ğŸ‡', c:'X3P5'}, {n:'è¥¿ç“œ', en:'WATERMELON', i:'ğŸ‰', c:'N8Y1'}, 
                    {n:'è‰è“', en:'STRAWBERRY', i:'ğŸ“', c:'Q6L3'}, {n:'é³³æ¢¨', en:'PINEAPPLE', i:'ğŸ', c:'F2T9'},
                    {n:'æ©˜å­', en:'TANGERINE', i:'ğŸŠ', c:'V5H4'}, {n:'æª¸æª¬', en:'LEMON', i:'ğŸ‹', c:'E7J8'}, 
                    {n:'æ¡ƒå­', en:'PEACH', i:'ğŸ‘', c:'O1W6'}, {n:'æ«»æ¡ƒ', en:'CHERRY', i:'ğŸ’', c:'S9G2'}, 
                    {n:'æ¢¨å­', en:'PEAR', i:'ğŸ', c:'A4B8'}, {n:'å¥‡ç•°æœ', en:'KIWI', i:'ğŸ¥', c:'C5D3'}
                ],
                animals: [
                    {n:'ç…å­', en:'LION', i:'ğŸ¦', c:'U2X7'}, {n:'è€è™', en:'TIGER', i:'ğŸ¯', c:'I5O9'}, 
                    {n:'ç†Š', en:'BEAR', i:'ğŸ»', c:'L8V4'}, {n:'ç‹¼', en:'WOLF', i:'ğŸº', c:'Y3K6'}, 
                    {n:'ç‹ç‹¸', en:'FOX', i:'ğŸ¦Š', c:'J1M5'}, {n:'ç†Šè²“', en:'PANDA', i:'ğŸ¼', c:'N7R2'},
                    {n:'ç„¡å°¾ç†Š', en:'KOALA', i:'ğŸ¨', c:'H4T8'}, {n:'å…”å­', en:'RABBIT', i:'ğŸ°', c:'Q9S1'}, 
                    {n:'è€é¼ ', en:'MOUSE', i:'ğŸ­', c:'P6F3'}, {n:'è²“å’ª', en:'CAT', i:'ğŸ±', c:'G2B9'}, 
                    {n:'ç‹—ç‹—', en:'DOG', i:'ğŸ¶', c:'E5W8'}, {n:'çŒ´å­', en:'MONKEY', i:'ğŸµ', c:'D3A7'}
                ],
                plants: [
                    {n:'ä»™äººæŒ', en:'CACTUS', i:'ğŸŒµ', c:'R9L4'}, {n:'æ¾æ¨¹', en:'PINE TREE', i:'ğŸŒ²', c:'M2H7'}, 
                    {n:'å‘æ—¥è‘µ', en:'SUNFLOWER', i:'ğŸŒ»', c:'K5P3'}, {n:'ç«ç‘°', en:'ROSE', i:'ğŸŒ¹', c:'V8X1'}, 
                    {n:'é¬±é‡‘é¦™', en:'TULIP', i:'ğŸŒ·', c:'J4O6'}, {n:'æ¥“è‘‰', en:'MAPLE', i:'ğŸ', c:'T7C2'},
                    {n:'è˜‘è‡', en:'MUSHROOM', i:'ğŸ„', c:'B3S9'}, {n:'ç«¹å­', en:'BAMBOO', i:'ğŸ‹', c:'N6F5'}, 
                    {n:'æ¤°å­æ¨¹', en:'PALM TREE', i:'ğŸŒ´', c:'Q1G8'}, {n:'å¹¸é‹è‰', en:'CLOVER', i:'ğŸ€', c:'Y5D2'}, 
                    {n:'ç¨»ç©—', en:'RICE', i:'ğŸŒ¾', c:'W8A4'}, {n:'èŠ™è“‰', en:'HIBISCUS', i:'ğŸŒº', c:'Z3E7'}
                ]
            }
        };

        // --- è®Šæ•¸ ---
        let myRole = null;
        let otherRole = null;
        let phaseIndex = 0;   
        const phaseOrder = ['fruits', 'animals', 'plants'];
        let currentTarget = null;
        
        let lives = 3; // ç”Ÿå‘½å€¼
        const maxLives = 3;

        // --- é‚è¼¯ ---

        function initGame(role) {
            myRole = role;
            otherRole = (role === 'A') ? 'B' : 'A';
            
            // è¨­å®šé¡è‰² (é®®è±”æŒ‰éˆ•)
            const roleColor = (role === 'A') ? 'var(--highlight-a)' : 'var(--highlight-b)';
            document.getElementById('role-indicator').innerText = `AGENT ${role}`;
            document.getElementById('role-indicator').style.color = roleColor;
            document.getElementById('unlock-btn').style.background = roleColor; // è¨­å®šæŒ‰éˆ•é¡è‰²

            document.getElementById('screen-select').classList.add('hidden');
            document.getElementById('screen-game').classList.remove('hidden');
            
            loadPhase();
        }

        function loadPhase() {
            const catName = phaseOrder[phaseIndex % 3];
            const phaseNum = phaseIndex + 1;
            
            document.getElementById('level-indicator').innerText = `LEVEL ${phaseNum}`;
            
            // éš¨æ©Ÿé¸é¡Œ
            const list = database[myRole][catName];
            currentTarget = list[Math.floor(Math.random() * list.length)];
            
            // é¡¯ç¤ºé¡Œç›®
            document.getElementById('target-icon').innerText = currentTarget.i;
            document.getElementById('target-name').innerText = currentTarget.n;
            document.getElementById('target-en').innerText = currentTarget.en;
            
            // é‡ç½®ç‹€æ…‹
            document.getElementById('input-code').value = '';
            resetLives();
        }

        function resetLives() {
            lives = maxLives;
            updateLivesUI();
        }

        function updateLivesUI() {
            let hearts = '';
            for(let i=0; i<lives; i++) hearts += 'â¤ï¸';
            for(let i=lives; i<maxLives; i++) hearts += 'ğŸ–¤';
            document.getElementById('lives-box').innerText = hearts;
        }

        function checkCode() {
            const inputEl = document.getElementById('input-code');
            let input = inputEl.value.toUpperCase().trim();
            
            if (input === currentTarget.c) {
                // æˆåŠŸ
                document.getElementById('success-counter').innerText = `å·²å®Œæˆ ${phaseIndex + 1} å€‹ä»»å‹™`;
                document.getElementById('screen-success').classList.remove('hidden');
            } else {
                // å¤±æ•—
                lives--;
                updateLivesUI();
                inputEl.value = '';
                
                // éœ‡å‹•
                inputEl.animate([
                    { transform: 'translateX(0)' }, { transform: 'translateX(10px)' },
                    { transform: 'translateX(-10px)' }, { transform: 'translateX(0)' }
                ], { duration: 200 });
                inputEl.style.borderColor = 'red';
                setTimeout(() => inputEl.style.borderColor = '#666', 500);

                if (lives <= 0) {
                    setTimeout(() => {
                        document.getElementById('screen-fail').classList.remove('hidden');
                    }, 500);
                }
            }
        }

        function nextLevel() {
            document.getElementById('screen-success').classList.add('hidden');
            phaseIndex++;
            loadPhase();
        }

        // --- å¯†ç¢¼æœ¬ ---
        function openCodebook() {
            document.getElementById('modal-overlay').classList.remove('hidden');
            const currentCat = phaseOrder[phaseIndex % 3];
            switchTab(currentCat);
        }
        function closeCodebook() {
            document.getElementById('modal-overlay').classList.add('hidden');
        }
        function switchTab(cat) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${cat}`).classList.add('active');
            renderList(database[otherRole][cat]);
        }
        function renderList(list) {
            const container = document.getElementById('code-list');
            container.innerHTML = '';
            const shuffled = [...list].sort(() => Math.random() - 0.5);
            shuffled.forEach(item => {
                const div = document.createElement('div');
                div.className = 'code-item';
                div.innerHTML = `
                    <div style="font-size:2rem;">${item.i}</div>
                    <div class="item-code">${item.c}</div>
                    <div class="item-en">${item.en}</div>
                    <div class="item-cn">${item.n}</div>
                `;
                container.appendChild(div);
            });
        }
    </script>
</body>
</html>
