<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DUAL AGENT LINK</title>
    <style>
        :root {
            --bg-color: #000000;
            --text-main: #ffffff;
            --highlight-a: #ff3333; /* ç‰¹å‹™ A ç´…è‰² */
            --highlight-b: #3388ff; /* ç‰¹å‹™ B è—è‰² */
            --common: #00ff41;      /* é€šç”¨ç¶ è‰² */
            --panel-bg: #1a1a1a;
            --border: #333;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 0;
            /* ä½¿ç”¨ 100dvh é¿å…æ‰‹æ©Ÿç€è¦½å™¨ç¶²å€åˆ—é®æ“‹å•é¡Œ */
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
        }

        .hidden { display: none !important; }

        /* --- 1. è§’è‰²é¸æ“‡é é¢ --- */
        #screen-select {
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            padding: 20px;
        }
        
        .title-box {
            text-align: center; margin-bottom: 40px; border: 2px solid #fff; padding: 10px 20px;
        }

        .role-btn {
            width: 100%; max-width: 320px; padding: 30px; margin: 15px 0;
            font-size: 1.5rem; font-weight: bold; border-radius: 16px;
            border: 2px solid #555; background: #111; color: #fff; cursor: pointer;
            text-transform: uppercase; transition: transform 0.1s;
            display: flex; align-items: center; justify-content: center;
        }
        .role-btn:active { transform: scale(0.95); }
        .role-a { border-color: var(--highlight-a); color: var(--highlight-a); box-shadow: 0 0 15px rgba(255, 51, 51, 0.2); }
        .role-b { border-color: var(--highlight-b); color: var(--highlight-b); box-shadow: 0 0 15px rgba(51, 136, 255, 0.2); }

        /* --- 2. éŠæˆ²ä¸»é é¢ --- */
        #screen-game {
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center;
            padding: 20px;
            padding-bottom: 50px; /* é ç•™åº•éƒ¨ç©ºé–“ */
            overflow-y: auto; /* å…è¨±å…§å®¹éé•·æ™‚æ²å‹• */
        }

        /* é ‚éƒ¨è³‡è¨Šåˆ— */
        .status-bar {
            width: 100%; max-width: 400px;
            display: flex; justify-content: space-between; 
            border-bottom: 2px solid #333; 
            padding-bottom: 10px; margin-bottom: 20px;
            font-size: 1rem; color: #888; font-weight: bold;
        }

        /* ä»»å‹™ç›®æ¨™å€ (åœ–ç¤ºèˆ‡åç¨±) */
        .target-area { 
            text-align: center; 
            margin-bottom: 30px; 
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            width: 100%; max-width: 400px;
        }
        .target-icon { font-size: 6rem; display: block; margin-bottom: 10px; animation: pulse 2s infinite; }
        .target-name { font-size: 1.8rem; color: #fff; font-weight: bold; letter-spacing: 2px; }
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }

        /* è¼¸å…¥å€ */
        .input-area { 
            width: 100%; max-width: 400px; 
            text-align: center; 
            margin-bottom: 40px; /* èˆ‡ä¸‹æ–¹æŒ‰éˆ•ä¿æŒè·é›¢ */
        }
        .game-input {
            background: #000; border: 3px solid #555; color: #fff;
            font-size: 2.5rem; padding: 15px; width: 100%; text-align: center;
            border-radius: 12px; outline: none; font-family: inherit; letter-spacing: 4px;
            text-transform: uppercase;
            margin-bottom: 15px;
        }
        .game-input:focus { border-color: #fff; }

        .submit-btn {
            width: 100%; padding: 15px; font-size: 1.2rem;
            background: #222; border: 1px solid #555; color: #aaa; border-radius: 12px;
            font-weight: bold;
        }
        .submit-btn:active { background: #333; color: #fff; }

        /* éŒ¯èª¤è¨Šæ¯ */
        #msg-box {
            height: 30px; color: #ff3333; font-weight: bold; font-size: 1.1rem; margin-bottom: 10px;
        }

        /* å¯†ç¢¼æœ¬æŒ‰éˆ• (ä¸å†æ˜¯æ‡¸æµ®ï¼Œè€Œæ˜¯å·¨å¤§çš„å€å¡Š) */
        .codebook-btn-container {
            width: 100%; max-width: 400px;
            margin-top: auto; /* æ¨åˆ°åº•éƒ¨ */
        }
        .codebook-btn {
            width: 100%;
            padding: 25px;
            background: var(--common); 
            color: #000;
            border: none;
            border-radius: 16px;
            font-size: 1.4rem;
            font-weight: 900;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 20px rgba(0, 255, 65, 0.3);
            cursor: pointer;
        }
        .codebook-btn:active { transform: scale(0.98); filter: brightness(0.9); }

        /* --- 3. å¯†ç¢¼æœ¬è¦–çª— (Modal) --- */
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; z-index: 100;
            display: flex; flex-direction: column;
        }
        .modal-header {
            padding: 20px; background: #222; border-bottom: 2px solid #444;
            display: flex; justify-content: space-between; align-items: center;
        }
        .modal-title { font-size: 1.2rem; font-weight: bold; color: #fff; }
        .modal-close { 
            background: #444; border: none; color: #fff; 
            font-size: 1.5rem; width: 40px; height: 40px; border-radius: 50%; 
        }

        /* åˆ†é æŒ‰éˆ• */
        .tabs { display: flex; width: 100%; background: #000; padding: 10px; gap: 10px; }
        .tab-btn {
            flex: 1; padding: 15px 0; background: #1a1a1a; color: #888; 
            border: 2px solid #333; border-radius: 8px; font-weight: bold; font-size: 1rem;
        }
        .tab-btn.active { 
            background: #222; color: var(--common); border-color: var(--common); 
        }

        /* å¯†ç¢¼åˆ—è¡¨ */
        #code-list {
            flex: 1; overflow-y: auto; padding: 15px; 
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; align-content: start;
            padding-bottom: 50px;
        }
        .code-item {
            background: #1a1a1a; padding: 15px; border-radius: 12px; border: 1px solid #333;
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }
        .item-icon { font-size: 2.5rem; margin-bottom: 5px; }
        .item-code { color: var(--common); font-size: 1.6rem; font-weight: 900; letter-spacing: 2px; margin: 5px 0; }
        .item-name { color: #aaa; font-size: 0.9rem; }

        /* --- 4. æˆåŠŸéé—œç•«é¢ --- */
        #screen-success {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 20, 0, 0.98); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 90; text-align: center; padding: 20px;
        }
        .next-btn {
            background: var(--common); color: #000; padding: 20px 50px; 
            font-size: 1.5rem; border: none; border-radius: 50px; 
            margin-top: 40px; font-weight: bold;
            box-shadow: 0 0 30px rgba(0,255,65,0.6);
            animation: float 2s infinite;
        }
        @keyframes float { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-5px);} }

    </style>
</head>
<body>

    <div id="screen-select">
        <div class="title-box">
            <h1 style="margin:0; letter-spacing:4px;">DUAL LINK</h1>
            <div style="font-size:0.8rem; color:#888; margin-top:5px;">CO-OP TERMINAL</div>
        </div>
        
        <button class="role-btn role-a" onclick="initGame('A')">
            ğŸ”´ æˆ‘æ˜¯ç‰¹å‹™ A
        </button>
        
        <button class="role-btn role-b" onclick="initGame('B')">
            ğŸ”µ æˆ‘æ˜¯ç‰¹å‹™ B
        </button>
        
        <p style="color:#666; font-size:0.9rem; margin-top:40px; text-align:center;">
            è«‹å…©ä½ç©å®¶åˆ†åˆ¥é¸æ“‡ä¸åŒèº«åˆ†<br>
            Do not choose the same role.
        </p>
    </div>

    <div id="screen-game" class="hidden">
        <div class="status-bar">
            <span id="role-indicator">AGENT ?</span>
            <span id="level-indicator">PHASE 1</span>
        </div>

        <div class="target-area">
            <div style="color: #888; font-size: 0.9rem; margin-bottom: 10px;">CURRENT TARGET (ç›®æ¨™)</div>
            <span id="target-icon" class="target-icon">â“</span>
            <span id="target-name" class="target-name">LOADING...</span>
        </div>

        <div id="msg-box"></div>

        <div class="input-area">
            <input type="text" id="input-code" class="game-input" placeholder="CODE" maxlength="4" autocomplete="off">
            <button class="submit-btn" onclick="checkCode()">è§£é– / UNLOCK</button>
        </div>

        <div class="codebook-btn-container">
            <button class="codebook-btn" onclick="openCodebook()">
                ğŸ“– æŸ¥çœ‹éšŠå‹å¯†ç¢¼æœ¬
            </button>
        </div>
    </div>

    <div id="screen-success" class="hidden">
        <div style="font-size: 6rem; margin-bottom: 20px;">âœ…</div>
        <h2 style="color: var(--common); font-size: 2.5rem; margin: 0;">SUCCESS</h2>
        <p style="color: #fff; font-size: 1.2rem; margin-top: 10px; opacity: 0.8;">
            ä»£ç¢¼æ­£ç¢º<br>Access Granted
        </p>
        <button class="next-btn" onclick="nextLevel()">ä¸‹ä¸€é—œ â”</button>
    </div>

    <div id="modal-overlay" class="hidden">
        <div class="modal-header">
            <div class="modal-title">å”åŠ©éšŠå‹æŸ¥è©¢ä»£ç¢¼</div>
            <button class="modal-close" onclick="closeCodebook()">âœ•</button>
        </div>
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('fruits')" id="tab-fruits">æ°´æœ</button>
            <button class="tab-btn" onclick="switchTab('animals')" id="tab-animals">å‹•ç‰©</button>
            <button class="tab-btn" onclick="switchTab('plants')" id="tab-plants">æ¤ç‰©</button>
        </div>
        <div id="code-list">
            </div>
    </div>

    <script>
        // --- 1. ç¡¬ç·¨ç¢¼è³‡æ–™åº« (Hardcoded Database) ---
        // ç¢ºä¿æ‰€æœ‰è£ç½®çš„ä»£ç¢¼éƒ½æ˜¯å›ºå®šçš„ï¼Œä¸æœƒå› ç‚ºé‡æ–°æ•´ç†è€Œæ”¹è®Š
        // æ ¼å¼ï¼šè‹±æ–‡+æ•¸å­—æ··å’Œ (Alphanumeric)
        
        const database = {
            // A çš„é¡Œç›® (Target)ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ B çš„å¯†ç¢¼æœ¬å…§å®¹
            A: {
                fruits: [
                    {n:'é¦™è•‰', i:'ğŸŒ', c:'A3X9'}, {n:'è˜‹æœ', i:'ğŸ', c:'P8K2'}, {n:'è‘¡è„', i:'ğŸ‡', c:'L5Z1'},
                    {n:'è¥¿ç“œ', i:'ğŸ‰', c:'W4N7'}, {n:'è‰è“', i:'ğŸ“', c:'S9R3'}, {n:'é³³æ¢¨', i:'ğŸ', c:'B2M6'},
                    {n:'æ©˜å­', i:'ğŸŠ', c:'O7T4'}, {n:'æª¸æª¬', i:'ğŸ‹', c:'Y1H5'}, {n:'æ¡ƒå­', i:'ğŸ‘', c:'J6Q8'},
                    {n:'æ«»æ¡ƒ', i:'ğŸ’', c:'C3V9'}, {n:'æ¢¨å­', i:'ğŸ', c:'D5F2'}, {n:'å¥‡ç•°æœ', i:'ğŸ¥', c:'G8E4'}
                ],
                animals: [
                    {n:'ç…å­', i:'ğŸ¦', c:'H4U9'}, {n:'è€è™', i:'ğŸ¯', c:'T7I2'}, {n:'ç†Š', i:'ğŸ»', c:'B5O1'},
                    {n:'ç‹¼', i:'ğŸº', c:'W8Y6'}, {n:'ç‹ç‹¸', i:'ğŸ¦Š', c:'F3L7'}, {n:'ç†Šè²“', i:'ğŸ¼', c:'P9A4'},
                    {n:'ç„¡å°¾ç†Š', i:'ğŸ¨', c:'K2J8'}, {n:'å…”å­', i:'ğŸ°', c:'R6M3'}, {n:'è€é¼ ', i:'ğŸ­', c:'M1N5'},
                    {n:'è²“å’ª', i:'ğŸ±', c:'C7X2'}, {n:'ç‹—ç‹—', i:'ğŸ¶', c:'D4Q9'}, {n:'çŒ´å­', i:'ğŸµ', c:'S2Z6'}
                ],
                plants: [
                    {n:'ä»™äººæŒ', i:'ğŸŒµ', c:'C8K3'}, {n:'æ¾æ¨¹', i:'ğŸŒ²', c:'T5R9'}, {n:'å‘æ—¥è‘µ', i:'ğŸŒ»', c:'S2L6'},
                    {n:'ç«ç‘°', i:'ğŸŒ¹', c:'R7V4'}, {n:'é¬±é‡‘é¦™', i:'ğŸŒ·', c:'U1H8'}, {n:'æ¥“è‘‰', i:'ğŸ', c:'M9P2'},
                    {n:'è˜‘è‡', i:'ğŸ„', c:'F4X7'}, {n:'ç«¹å­', i:'ğŸ‹', c:'B6O3'}, {n:'æ¤°å­æ¨¹', i:'ğŸŒ´', c:'P3Y5'},
                    {n:'å¹¸é‹è‰', i:'ğŸ€', c:'L8N1'}, {n:'ç¨»ç©—', i:'ğŸŒ¾', c:'G5J2'}, {n:'èŠ™è“‰', i:'ğŸŒº', c:'H9Q4'}
                ]
            },
            // B çš„é¡Œç›® (Target)ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ A çš„å¯†ç¢¼æœ¬å…§å®¹ (ä»£ç¢¼å¿…é ˆèˆ‡ A ä¸åŒ)
            B: {
                fruits: [
                    {n:'é¦™è•‰', i:'ğŸŒ', c:'K9R2'}, {n:'è˜‹æœ', i:'ğŸ', c:'Z4M7'}, {n:'è‘¡è„', i:'ğŸ‡', c:'X3P5'},
                    {n:'è¥¿ç“œ', i:'ğŸ‰', c:'N8Y1'}, {n:'è‰è“', i:'ğŸ“', c:'Q6L3'}, {n:'é³³æ¢¨', i:'ğŸ', c:'F2T9'},
                    {n:'æ©˜å­', i:'ğŸŠ', c:'V5H4'}, {n:'æª¸æª¬', i:'ğŸ‹', c:'E7J8'}, {n:'æ¡ƒå­', i:'ğŸ‘', c:'O1W6'},
                    {n:'æ«»æ¡ƒ', i:'ğŸ’', c:'S9G2'}, {n:'æ¢¨å­', i:'ğŸ', c:'A4B8'}, {n:'å¥‡ç•°æœ', i:'ğŸ¥', c:'C5D3'}
                ],
                animals: [
                    {n:'ç…å­', i:'ğŸ¦', c:'U2X7'}, {n:'è€è™', i:'ğŸ¯', c:'I5O9'}, {n:'ç†Š', i:'ğŸ»', c:'L8V4'},
                    {n:'ç‹¼', i:'ğŸº', c:'Y3K6'}, {n:'ç‹ç‹¸', i:'ğŸ¦Š', c:'J1M5'}, {n:'ç†Šè²“', i:'ğŸ¼', c:'N7R2'},
                    {n:'ç„¡å°¾ç†Š', i:'ğŸ¨', c:'H4T8'}, {n:'å…”å­', i:'ğŸ°', c:'Q9S1'}, {n:'è€é¼ ', i:'ğŸ­', c:'P6F3'},
                    {n:'è²“å’ª', i:'ğŸ±', c:'G2B9'}, {n:'ç‹—ç‹—', i:'ğŸ¶', c:'E5W8'}, {n:'çŒ´å­', i:'ğŸµ', c:'D3A7'}
                ],
                plants: [
                    {n:'ä»™äººæŒ', i:'ğŸŒµ', c:'R9L4'}, {n:'æ¾æ¨¹', i:'ğŸŒ²', c:'M2H7'}, {n:'å‘æ—¥è‘µ', i:'ğŸŒ»', c:'K5P3'},
                    {n:'ç«ç‘°', i:'ğŸŒ¹', c:'V8X1'}, {n:'é¬±é‡‘é¦™', i:'ğŸŒ·', c:'J4O6'}, {n:'æ¥“è‘‰', i:'ğŸ', c:'T7C2'},
                    {n:'è˜‘è‡', i:'ğŸ„', c:'B3S9'}, {n:'ç«¹å­', i:'ğŸ‹', c:'N6F5'}, {n:'æ¤°å­æ¨¹', i:'ğŸŒ´', c:'Q1G8'},
                    {n:'å¹¸é‹è‰', i:'ğŸ€', c:'Y5D2'}, {n:'ç¨»ç©—', i:'ğŸŒ¾', c:'W8A4'}, {n:'èŠ™è“‰', i:'ğŸŒº', c:'Z3E7'}
                ]
            }
        };

        // --- 2. éŠæˆ²è®Šæ•¸ ---
        let myRole = null;    // 'A' or 'B'
        let otherRole = null; // 'B' or 'A'
        let phaseIndex = 0;   
        const phaseOrder = ['fruits', 'animals', 'plants'];
        let currentTarget = null;

        // --- 3. åˆå§‹åŒ–èˆ‡é‚è¼¯ ---
        function initGame(role) {
            myRole = role;
            otherRole = (role === 'A') ? 'B' : 'A';
            
            // è¨­å®šé¡è‰²
            const color = (role === 'A') ? 'var(--highlight-a)' : 'var(--highlight-b)';
            document.getElementById('role-indicator').innerText = `AGENT ${role}`;
            document.getElementById('role-indicator').style.color = color;
            document.getElementById('input-code').style.borderColor = color;

            // åˆ‡æ›ç•«é¢
            document.getElementById('screen-select').classList.add('hidden');
            document.getElementById('screen-game').classList.remove('hidden');
            
            loadPhase();
        }

        function loadPhase() {
            const catName = phaseOrder[phaseIndex % 3];
            const phaseNum = phaseIndex + 1;
            
            document.getElementById('level-indicator').innerText = `PHASE ${phaseNum}: ${catName.toUpperCase()}`;
            
            // éš¨æ©Ÿé¸å–ç›®æ¨™ (å¾æˆ‘è‡ªå·±çš„è³‡æ–™åº« myRole é¸æ“‡)
            const list = database[myRole][catName];
            currentTarget = list[Math.floor(Math.random() * list.length)];
            
            // é¡¯ç¤º
            document.getElementById('target-icon').innerText = currentTarget.i;
            document.getElementById('target-name').innerText = currentTarget.n;
            
            // é‡ç½®è¼¸å…¥æ¡†
            document.getElementById('input-code').value = '';
            document.getElementById('msg-box').innerText = '';
        }

        function checkCode() {
            const inputEl = document.getElementById('input-code');
            let input = inputEl.value.toUpperCase().trim();
            
            if (input === currentTarget.c) {
                document.getElementById('screen-success').classList.remove('hidden');
            } else {
                const msg = document.getElementById('msg-box');
                msg.innerText = 'âŒ ACCESS DENIED';
                inputEl.style.borderColor = 'red';
                
                // éœ‡å‹•æ•ˆæœ (CSS)
                inputEl.animate([
                    { transform: 'translateX(0)' },
                    { transform: 'translateX(10px)' },
                    { transform: 'translateX(-10px)' },
                    { transform: 'translateX(0)' }
                ], { duration: 200 });

                setTimeout(() => { 
                    inputEl.style.borderColor = (myRole === 'A' ? 'var(--highlight-a)' : 'var(--highlight-b)'); 
                    msg.innerText = ''; 
                }, 1500);
                
                inputEl.value = '';
            }
        }

        function nextLevel() {
            document.getElementById('screen-success').classList.add('hidden');
            phaseIndex++;
            loadPhase();
        }

        // --- 4. å¯†ç¢¼æœ¬é‚è¼¯ ---
        function openCodebook() {
            document.getElementById('modal-overlay').classList.remove('hidden');
            // é è¨­æ‰“é–‹ç•¶å‰é—œå¡å°æ‡‰çš„é¡åˆ¥
            const currentCat = phaseOrder[phaseIndex % 3];
            switchTab(currentCat);
        }

        function closeCodebook() {
            document.getElementById('modal-overlay').classList.add('hidden');
        }

        function switchTab(cat) {
            // UI æ›´æ–°
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${cat}`).classList.add('active');

            // æ¸²æŸ“åˆ—è¡¨ï¼šé¡¯ç¤ºã€Œå°æ–¹ã€çš„è³‡æ–™ (otherRole)
            const list = database[otherRole][cat];
            renderList(list);
        }

        function renderList(list) {
            const container = document.getElementById('code-list');
            container.innerHTML = '';

            // æ¯æ¬¡æ‰“é–‹éƒ½æ´—ç‰Œ (Shuffle)ï¼Œé˜²æ­¢ç©å®¶è¨˜ä½ç½®
            const shuffled = [...list].sort(() => Math.random() - 0.5);

            shuffled.forEach(item => {
                const div = document.createElement('div');
                div.className = 'code-item';
                div.innerHTML = `
                    <div class="item-icon">${item.i}</div>
                    <div class="item-code">${item.c}</div>
                    <div class="item-name">${item.n}</div>
                `;
                container.appendChild(div);
            });
        }

    </script>
</body>
</html>
