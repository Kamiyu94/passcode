<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DUAL AGENT TERMINAL</title>
    <style>
        :root {
            --bg-color: #000000;
            --text-main: #e0e0e0;
            --highlight-a: #ff3333; /* ÁâπÂãô A Á¥ÖËâ≤ */
            --highlight-b: #3388ff; /* ÁâπÂãô B ËóçËâ≤ */
            --common: #00ff41;      /* ÈÄöÁî®Á∂†Ëâ≤ */
            --panel-bg: #111111;
            --border: #333;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 0;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .hidden { display: none !important; }

        /* --- SCREEN 1: SELECTION --- */
        #screen-select {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px;
        }
        .role-btn {
            width: 100%; max-width: 300px; padding: 30px; margin: 15px 0;
            font-size: 1.5rem; font-weight: bold; border-radius: 12px;
            border: 2px solid #555; background: #111; color: #fff; cursor: pointer;
            text-transform: uppercase; transition: transform 0.1s;
        }
        .role-btn:active { transform: scale(0.95); }
        .role-a { border-color: var(--highlight-a); color: var(--highlight-a); }
        .role-b { border-color: var(--highlight-b); color: var(--highlight-b); }

        /* --- SCREEN 2: GAME --- */
        #screen-game {
            flex: 1; display: flex; flex-direction: column; padding: 20px; padding-top: 5vh; align-items: center;
        }

        /* Header Info */
        .status-bar {
            width: 100%; display: flex; justify-content: space-between; 
            border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px;
            font-size: 0.9rem; color: #888;
        }
        #role-indicator { font-weight: bold; font-size: 1.1rem; }

        /* Target Display */
        .target-area { text-align: center; margin-bottom: 30px; flex: 1; display: flex; flex-direction: column; justify-content: center;}
        .target-icon { font-size: 6rem; display: block; margin-bottom: 10px; animation: float 3s ease-in-out infinite; }
        .target-name { font-size: 1.5rem; color: #fff; font-weight: bold; letter-spacing: 2px; }
        
        @keyframes float { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-10px);} }

        /* Input Area */
        .input-area { width: 100%; max-width: 320px; text-align: center; margin-bottom: 20px; }
        .game-input {
            background: #000; border: 2px solid #555; color: #fff;
            font-size: 2rem; padding: 15px; width: 100%; text-align: center;
            border-radius: 8px; outline: none; font-family: inherit; letter-spacing: 2px;
        }
        .submit-btn {
            margin-top: 15px; width: 100%; padding: 15px; font-size: 1.2rem;
            background: #222; border: 1px solid #555; color: #aaa; border-radius: 8px;
        }
        
        /* Codebook Button */
        .codebook-trigger {
            position: fixed; bottom: 30px; right: 20px;
            background: var(--common); color: #000;
            width: 60px; height: 60px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; box-shadow: 0 0 20px rgba(0,255,65,0.3);
            z-index: 50; border: none; cursor: pointer;
        }
        .codebook-label {
            position: absolute; right: 70px; background: #000; color: var(--common);
            padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; white-space: nowrap;
            border: 1px solid var(--common);
        }

        /* --- MODAL: CODEBOOK --- */
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100;
            display: flex; flex-direction: column;
        }
        .modal-header {
            padding: 15px; background: #111; border-bottom: 1px solid #333;
            display: flex; justify-content: space-between; align-items: center;
        }
        .modal-close { background: none; border: none; color: #fff; font-size: 1.5rem; padding: 0 10px; }
        
        /* Tabs */
        .tabs { display: flex; width: 100%; background: #000; }
        .tab-btn {
            flex: 1; padding: 15px 0; background: #111; color: #666; border: none; border-bottom: 3px solid transparent; font-weight: bold;
        }
        .tab-btn.active { background: #222; color: var(--common); border-bottom-color: var(--common); }

        /* List */
        #code-list {
            flex: 1; overflow-y: auto; padding: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; align-content: start;
        }
        .code-item {
            background: #1a1a1a; padding: 10px; border-radius: 8px; border: 1px solid #333;
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }
        .item-icon { font-size: 2rem; margin-bottom: 5px; }
        .item-code { color: var(--common); font-size: 1.2rem; font-weight: bold; letter-spacing: 1px; }
        .item-name { color: #888; font-size: 0.8rem; margin-top: 2px; }

        /* SUCCESS OVERLAY */
        #screen-success {
            background: rgba(0, 30, 0, 0.95); justify-content: center; text-align: center;
        }
        .next-btn {
            background: var(--common); color: #000; padding: 20px 40px; font-size: 1.5rem; border: none; border-radius: 50px; margin-top: 30px; font-weight: bold;
            box-shadow: 0 0 30px rgba(0,255,65,0.5);
        }

    </style>
</head>
<body>

    <div id="screen-select">
        <h1 style="color: #fff; letter-spacing: 3px; margin-bottom: 40px;">TERMINAL LINK</h1>
        <button class="role-btn role-a" onclick="initGame('A')">ÊàëÊòØÁâπÂãô A<br><span style="font-size:0.9rem; opacity:0.7;">(Agent Alpha)</span></button>
        <button class="role-btn role-b" onclick="initGame('B')">ÊàëÊòØÁâπÂãô B<br><span style="font-size:0.9rem; opacity:0.7;">(Agent Bravo)</span></button>
        <p style="color:#666; font-size:0.8rem; margin-top:30px;">Ë´ãÂú®ÂÖ©Âè∞Ë£ùÁΩÆÂàÜÂà•ÈÅ∏Êìá‰∏çÂêåËßíËâ≤</p>
    </div>

    <div id="screen-game" class="hidden">
        <div class="status-bar">
            <span id="role-indicator">AGENT A</span>
            <span id="level-indicator">PHASE 1: FRUITS</span>
        </div>

        <div class="target-area">
            <div style="color: #888; font-size: 0.9rem; margin-bottom: 10px;">CURRENT TARGET (ÁõÆÊ®ô)</div>
            <span id="target-icon" class="target-icon">‚ùì</span>
            <span id="target-name" class="target-name">LOADING...</span>
        </div>

        <div class="input-area">
            <input type="number" id="input-code" class="game-input" placeholder="Ëº∏ÂÖ•‰ª£Á¢º" inputmode="numeric">
            <button class="submit-btn" onclick="checkCode()">Ëß£Èéñ / UNLOCK</button>
        </div>
        
        <div id="msg-box" style="height: 20px; color: #ff3333; font-weight: bold;"></div>

        <button class="codebook-trigger" onclick="openCodebook()">
            üìñ
            <div class="codebook-label">Êü•Ë©¢ÈöäÂèã‰ª£Á¢º</div>
        </button>
    </div>

    <div id="screen-success" class="hidden screen" style="position:fixed; top:0; left:0; width:100%; height:100%; display:none; flex-direction:column; align-items:center; z-index:90;">
        <div style="font-size: 5rem;">‚úÖ</div>
        <h2 style="color: var(--common); font-size: 2rem; margin: 20px 0;">ACCESS GRANTED</h2>
        <p style="color: #fff;">‰ª£Á¢ºÊ≠£Á¢∫ÔºåÊ∫ñÂÇôÈÄ≤ÂÖ•‰∏ã‰∏ÄÂ±§Á¥ö„ÄÇ</p>
        <button class="next-btn" onclick="nextLevel()">‰∏ã‰∏ÄÈóú ‚ûî</button>
    </div>

    <div id="modal-overlay" class="hidden">
        <div class="modal-header">
            <span style="color:#fff; font-weight:bold;">ÂçîÂä©ÈöäÂèãÊü•Ë©¢‰ª£Á¢º</span>
            <button class="modal-close" onclick="closeCodebook()">‚úï</button>
        </div>
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('fruits')" id="tab-fruits">Ê∞¥Êûú</button>
            <button class="tab-btn" onclick="switchTab('animals')" id="tab-animals">ÂãïÁâ©</button>
            <button class="tab-btn" onclick="switchTab('plants')" id="tab-plants">Ê§çÁâ©</button>
        </div>
        <div id="code-list">
            </div>
    </div>

    <script>
        // --- Ë≥áÊñôÂ∫´ (Database) ---
        // ÂÖ©ÂÄãÈöä‰ºçÂ∞çÂêå‰∏ÄÂÄãÁâ©ÂìÅÊúâ„Äå‰∏çÂêåÁöÑ‰ª£Á¢º„Äç
        const rawData = {
            fruits: [
                {n:'È¶ôËïâ', i:'üçå'}, {n:'ËòãÊûú', i:'üçé'}, {n:'Ëë°ËêÑ', i:'üçá'}, {n:'Ë•øÁìú', i:'üçâ'},
                {n:'ËçâËéì', i:'üçì'}, {n:'È≥≥Ê¢®', i:'üçç'}, {n:'Ê©òÂ≠ê', i:'üçä'}, {n:'Ê™∏Ê™¨', i:'üçã'},
                {n:'Ê°ÉÂ≠ê', i:'üçë'}, {n:'Ê´ªÊ°É', i:'üçí'}, {n:'Ê¢®Â≠ê', i:'üçê'}, {n:'Â•áÁï∞Êûú', i:'ü•ù'}
            ],
            animals: [
                {n:'ÁçÖÂ≠ê', i:'ü¶Å'}, {n:'ËÄÅËôé', i:'üêØ'}, {n:'ÁÜä', i:'üêª'}, {n:'Áãº', i:'üê∫'},
                {n:'ÁãêÁã∏', i:'ü¶ä'}, {n:'ÁÜäË≤ì', i:'üêº'}, {n:'ÁÑ°Â∞æÁÜä', i:'üê®'}, {n:'ÂÖîÂ≠ê', i:'üê∞'},
                {n:'ËÄÅÈº†', i:'üê≠'}, {n:'Ë≤ìÂí™', i:'üê±'}, {n:'ÁãóÁãó', i:'üê∂'}, {n:'Áå¥Â≠ê', i:'üêµ'}
            ],
            plants: [
                {n:'‰ªô‰∫∫Êéå', i:'üåµ'}, {n:'ÊùæÊ®π', i:'üå≤'}, {n:'ÂêëÊó•Ëëµ', i:'üåª'}, {n:'Áé´Áë∞', i:'üåπ'},
                {n:'È¨±ÈáëÈ¶ô', i:'üå∑'}, {n:'Ê•ìËëâ', i:'üçÅ'}, {n:'ËòëËèá', i:'üçÑ'}, {n:'Á´πÂ≠ê', i:'üéã'},
                {n:'Ê§∞Â≠êÊ®π', i:'üå¥'}, {n:'Âπ∏ÈÅãËçâ', i:'üçÄ'}, {n:'Á®ªÁ©ó', i:'üåæ'}, {n:'ËäôËìâ', i:'üå∫'}
            ]
        };

        // Áî¢Áîü‰∫ÇÊï∏‰ª£Á¢ºÁöÑÂáΩÊï∏ (‰øùË≠â A Âíå B ‰∏çÂêå)
        function generateCodes() {
            const db = { A: { fruits:[], animals:[], plants:[] }, B: { fruits:[], animals:[], plants:[] } };
            
            ['fruits', 'animals', 'plants'].forEach(cat => {
                rawData[cat].forEach(item => {
                    // ÁÇ∫ A Áî¢Áîü‰∏ÄÂÄã 4 ‰ΩçÊï∏‰ª£Á¢º
                    let codeA = Math.floor(1000 + Math.random() * 9000).toString();
                    // ÁÇ∫ B Áî¢Áîü‰∏ÄÂÄã‰∏çÂêåÁöÑ 4 ‰ΩçÊï∏‰ª£Á¢º
                    let codeB = Math.floor(1000 + Math.random() * 9000).toString();
                    while(codeB === codeA) codeB = Math.floor(1000 + Math.random() * 9000).toString();

                    db.A[cat].push({ ...item, c: codeA });
                    db.B[cat].push({ ...item, c: codeB });
                });
            });
            return db;
        }

        // ÂàùÂßãÂåñË≥áÊñôÂ∫´
        const fullDB = generateCodes();

        // --- ÈÅäÊà≤ÁãÄÊÖã ---
        let myRole = null;    // 'A' or 'B'
        let otherRole = null; // 'B' or 'A'
        let phaseIndex = 0;   // 0=fruits, 1=animals, 2=plants, 3=fruits...
        const phaseOrder = ['fruits', 'animals', 'plants'];
        let currentTarget = null;
        let currentTab = 'fruits'; // ÂØÜÁ¢ºÊú¨Áï∂ÂâçÂàÜÈ†Å

        // --- Ê†∏ÂøÉÈÇèËºØ ---

        function initGame(role) {
            myRole = role;
            otherRole = (role === 'A') ? 'B' : 'A';
            
            // Ë®≠ÂÆö UI È°èËâ≤
            const color = (role === 'A') ? '#ff3333' : '#3388ff';
            document.getElementById('input-code').style.borderColor = color;
            document.getElementById('role-indicator').innerText = `AGENT ${role}`;
            document.getElementById('role-indicator').style.color = color;

            // ÂàáÊèõÁï´Èù¢
            document.getElementById('screen-select').classList.add('hidden');
            document.getElementById('screen-game').classList.remove('hidden');

            // ÈñãÂßãÁ¨¨‰∏ÄÈóú
            loadPhase();
        }

        function loadPhase() {
            // Ë®àÁÆóÁï∂ÂâçÈ°ûÂà•
            const catName = phaseOrder[phaseIndex % 3];
            const phaseNum = phaseIndex + 1;
            
            // Êõ¥Êñ∞Ê®ôÈ°å
            document.getElementById('level-indicator').innerText = `LV.${phaseNum}: ${catName.toUpperCase()}`;
            
            // Èö®Ê©üÈÅ∏ÂèñÁõÆÊ®ô (ÂæûÊàëËá™Â∑±ÁöÑÊï∏ÊìöÂ∫´ÈÅ∏)
            const list = fullDB[myRole][catName];
            currentTarget = list[Math.floor(Math.random() * list.length)];
            
            // È°ØÁ§∫ÁõÆÊ®ô
            document.getElementById('target-icon').innerText = currentTarget.i;
            document.getElementById('target-name').innerText = currentTarget.n;
            document.getElementById('input-code').value = '';
            document.getElementById('msg-box').innerText = '';
        }

        function checkCode() {
            const input = document.getElementById('input-code').value;
            if (input === currentTarget.c) {
                // ÊàêÂäü
                const successScreen = document.getElementById('screen-success');
                successScreen.style.display = 'flex'; // Flex to center content
            } else {
                // Â§±Êïó
                const msg = document.getElementById('msg-box');
                msg.innerText = '‚õî ACCESS DENIED (ÂØÜÁ¢ºÈåØË™§)';
                const inputEl = document.getElementById('input-code');
                inputEl.style.borderColor = 'red';
                setTimeout(() => { inputEl.style.borderColor = (myRole==='A'?'#ff3333':'#3388ff'); msg.innerText=''; }, 1000);
                inputEl.value = '';
            }
        }

        function nextLevel() {
            document.getElementById('screen-success').style.display = 'none';
            phaseIndex++;
            loadPhase();
        }

        // --- ÂØÜÁ¢ºÊú¨ÈÇèËºØ (È°ØÁ§∫Â∞çÊñπÁöÑË≥áÊñô) ---

        function openCodebook() {
            document.getElementById('modal-overlay').classList.remove('hidden');
            // È†êË®≠ÊâìÈñãÁï∂ÂâçÈóúÂç°Â∞çÊáâÁöÑÈ°ûÂà•ÔºåÊñπ‰æøÁé©ÂÆ∂
            const currentCat = phaseOrder[phaseIndex % 3];
            switchTab(currentCat); 
        }

        function closeCodebook() {
            document.getElementById('modal-overlay').classList.add('hidden');
        }

        function switchTab(cat) {
            currentTab = cat;
            
            // Êõ¥Êñ∞ Tab Ê®£Âºè
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${cat}`).classList.add('active');

            // Ê∏≤ÊüìÂàóË°® (È°ØÁ§∫Â∞çÊñπÁöÑË≥áÊñô!)
            renderList(fullDB[otherRole][cat]);
        }

        function renderList(list) {
            const container = document.getElementById('code-list');
            container.innerHTML = '';

            // Ë§áË£Ω‰∏Ä‰ªΩ‰∏¶Ê¥óÁâå (Shuffle)
            const shuffled = [...list].sort(() => Math.random() - 0.5);

            shuffled.forEach(item => {
                const div = document.createElement('div');
                div.className = 'code-item';
                div.innerHTML = `
                    <div class="item-icon">${item.i}</div>
                    <div class="item-code">${item.c}</div>
                    <div class="item-name">${item.n}</div>
                `;
                container.appendChild(div);
            });
        }

    </script>
</body>
</html>
